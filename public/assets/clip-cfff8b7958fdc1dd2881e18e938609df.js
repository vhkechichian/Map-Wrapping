function updateFormats(){formats={out:{wkt:new OpenLayers.Format.WKT,geojson:new OpenLayers.Format.GeoJSON,georss:new OpenLayers.Format.GeoRSS,gml:new OpenLayers.Format.GML,kml:new OpenLayers.Format.KML}}}function clipinit(){var e=new OpenLayers.Control.MouseDefaults,a=clip_image_width+1e3,t=clip_image_height+500;clipmap=new OpenLayers.Map("clipmap",{controls:[e,new OpenLayers.Control.PanZoomBar],maxExtent:new OpenLayers.Bounds(-1e3,0,a,t),maxResolution:"auto",numZoomLevels:9});var o=new OpenLayers.Layer.WMS(title,clip_wms_url,{layers:"basic",format:"image/png",status:"unwarped"});clipmap.addLayer(o),clipmap.getCenter()||clipmap.zoomToMaxExtent(),vectors=gml_file_exists?new OpenLayers.Layer.GML("GML",gml_url):new OpenLayers.Layer.Vector("Vector Layer"),clipmap.addLayer(vectors),updateFormats(),vectors.styleMap.styles.temporary.defaultStyle.strokeWidth=3;var n,r={onModificationStart:function(){},onModification:function(){},onModificationEnd:function(){},onDelete:function(){},title:"Modify existing polygon",displayClass:"olControlModifyFeature"};modify=new OpenLayers.Control.ModifyFeature(vectors,r),modify.events.register("activate",this,function(){n=null}),navigate=new OpenLayers.Control.Navigation({title:"Move around Map"}),navigate.events.register("activate",this,function(){n&&polygon.drawFeature(n)}),polygon=new OpenLayers.Control.DrawFeature(vectors,OpenLayers.Handler.Polygon,{callbacks:{cancel:function(e){n=e.clone()}}},{title:"Draw new polygon to mask",displayClass:"olControlDrawFeature"}),polygon.featureAdded=function(){n=null,polygon.deactivate(),modify.activate()},deletePoly=new OpenLayers.Control.SelectFeature(vectors,{onSelect:deletePolygon,title:"Delete a polygon",displayClass:"olControlDeleteFeature"});var l=new OpenLayers.Control.Panel({displayClass:"olControlEditingToolbar2"});l.addControls([deletePoly,modify,polygon,navigate]),clipmap.addControl(l),navigate.activate()}function deletePolygon(e){var a=confirm("Really delete this?");a===!0&&vectors.removeFeatures([e]),deletePoly.unselectAll(),deletePoly.deactivate(),navigate.activate()}function destroyMask(){vectors.destroyFeatures()}function deselect(){modify.deactivate(),polygon.deactivate()}function serialize_features(){var e=formats.out.gml.write(vectors.features);document.getElementById("output").value=e}function updateOtherMaps(){"undefined"!=typeof to_map&&"undefined"!=typeof warped_layer&&(warped_layer.mergeNewParams({random:Math.random()}),warped_layer.redraw(!0)),"undefined"!=typeof warpedmap&&"undefined"!=typeof warped_wmslayer&&(warped_wmslayer.mergeNewParams({random:Math.random()}),warped_wmslayer.redraw(!0))}var vectors,formats,controls,clipmap,navigate,modify,polygon,deletePoly;